<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NFC Student ID Reader</title>
</head>
<body>
    <button id="scan">Scan NFC Tag</button>
    <p id="studentId">Data will appear here.</p>

    <script>
        document.getElementById('scan').addEventListener('click', async () => {
            if ('NDEFReader' in window) {
                try {
                    const reader = new NDEFReader();
                    await reader.scan();

                    reader.onreading = event => {
                        let textContent = 'Data found: ';
                        for (const record of event.message.records) {
                            console.log(`Record type: ${record.recordType}`);
                            console.log(`MIME type: ${record.mediaType}`);
                            console.log(`Record id: ${record.id}`);

                            switch (record.recordType) {
                                case "text":
                                case "url":
                                    // Directly decode text and URL records
                                    const textDecoder = new TextDecoder();
                                    textContent += textDecoder.decode(record.data) + " ";
                                    break;
                                default:
                                    // Attempt a generic decoding for other types
                                    try {
                                        const genericDecoder = new TextDecoder();
                                        let decodedData = genericDecoder.decode(record.data);
                                        if (decodedData) {
                                            textContent += decodedData + " ";
                                        } else {
                                            textContent += "Unsupported data format; ";
                                        }
                                    } catch(e) {
                                        textContent += "Error decoding data; ";
                                    }
                                    break;
                            }
                        }

                        // Update the UI with the content from the NFC tag
                        document.getElementById('studentId').textContent = textContent;
                    };
                    console.log("NFC reader is scanning...");
                } catch (error) {
                    console.error(`Error: ${error}.`);
                }
            } else {
                console.log("Web NFC is not supported.");
                alert("Web NFC is not supported on this browser/device.");
            }
        });
    </script>
</body>
</html>
